# Traitements des données chirps et cmip6

# Librairies
library(raster)
library(hydroGOF)
library(verification)

# Repertoire de travail
setwd("E:/Etude/Donnees/")

# Ouvrir les données
fichiers <- list.files() 
# [1] "masked_sum_mon_ACCESS-CM2.nc"       "masked_sum_mon_ACCESS-ESM1-5.nc"   
# [3] "masked_sum_mon_CanESM5.nc"          "masked_sum_mon_chirps.nc"          
# [5] "masked_sum_mon_CMCC-CM2-SR5.nc"     "masked_sum_mon_CMCC-ESM2.nc"       
# [7] "masked_sum_mon_CNRM-CM6-1.nc"       "masked_sum_mon_CNRM-ESM2-1.nc"     
# [9] "masked_sum_mon_EC-Earth3-Veg-LR.nc" "masked_sum_mon_EC-Earth3.nc"       
# [11] "masked_sum_mon_FGOALS-g3.nc"        "masked_sum_mon_GFDL-ESM4.nc"       
# [13] "masked_sum_mon_GISS-E2-1-G.nc"      "masked_sum_mon_HadGEM3-GC31-LL.nc" 
# [15] "masked_sum_mon_INM-CM4-8.nc"        "masked_sum_mon_INM-CM5-0.nc"       
# [17] "masked_sum_mon_IPSL-CM6A-LR.nc"     "masked_sum_mon_KACE-1-0-G.nc"      
# [19] "masked_sum_mon_KIOST-ESM.nc"        "masked_sum_mon_MIROC-ES2L.nc"      
# [21] "masked_sum_mon_MIROC6.nc"           "masked_sum_mon_MPI-ESM1-2-HR.nc"   
# [23] "masked_sum_mon_MPI-ESM1-2-LR.nc"    "masked_sum_mon_MRI-ESM2-0.nc"      
# [25] "masked_sum_mon_NorESM2-LM.nc"       "masked_sum_mon_NorESM2-MM.nc"      
# [27] "masked_sum_mon_TaiESM1.nc"          "masked_sum_mon_UKESM1-0-LL.nc"

chirps <- brick("masked_sum_mon_chirps.nc")
modele1 <- brick("masked_sum_mon_ACCESS-CM2.nc")
plot(chirps)
plot(modele1)

# Extraction des données de pluie en vecteur
pr_c <- getValues(chirps)
observed <- as.vector(pr_c)
pr_m1 <- getValues(modele1)
modeled <- as.vector(pr_m1)

observed <- observed[!is.na(observed)]
modeled <- modeled[!is.na(modeled)]

##### Calculs stats ####
# Coef de corrélation
cc <- cor(observed, modeled)
# Biais
bias <- mean(observed - modeled)
# root mean square error (RMSE)
rootmse <- rmse(observed, modeled)
# Nash–Sutcliffe efficiency (NSE)
nashse <- NSE(observed, modeled)
# mean absolute error (MAE)
meanae <- mae(observed, modeled)
# Kling-Gupta Efficiency (KGE)
Kling_GE <- KGE(observed, modeled)
